# デザイナーズガイド

このドキュメントは、ゲームデザイナーが自作ゲームをゲーム定義ファイルへと落とし込むために必要な情報をまとめたものです。  

## 目次

* [想定する読者](designersguide.md#想定する読者)
* [aglabの大原則](designersguide.md#aglabの大原則)
* [コンポーネント(components)](designersguide.md#コンポーネントcomponents)
 * [基本プロパティ](designersguide.md#基本プロパティ)
 * [フィールド(fields)](designersguide.md#フィールドfields)
 * [コンポーネントの設定項目](designersguide.md#コンポーネントの設定項目)
* [コンテキスト(contexts)](designersguide.md#コンテキストcontexts)
 * [数字への変換](designersguide.md#数字への変換)
 * [コンテキストの設定項目](designersguide.md#コンテキストの設定項目)
 * [キューとスタック](designersguide.md#キューとスタック)
 * [少し高度なコンテキストの定義例](designersguide.md#少し高度なコンテキストの定義例)
* [モジュール](designersguide.md#モジュール)


## 想定する読者

このドキュメントの読者として、ゲームデザイナーであり、かつ何らかのプログラミング言語を理解してる方を想定しています。  
ターゲット絞り込みすぎだろ感はありますが、aglabの真価が「テストプレイの自動化」にある以上、プログラミングスキルは必須となってしまいます。  


## aglabの大原則

aglabはゲーム内の全ての情報を「数字で」管理しています。  
人間が見て分かりやすいように文字で定義・表示している箇所もありますが、これがaglabの大原則です。  

またaglabでは、ゲーム内の情報を「コンポーネント」と「コンテキスト」とに分けて管理しています。  


## コンポーネント(components)

ほとんどのアナログゲームは、カード、チップ、木製コマなどのコンポーネントを使用してプレイされます。  
aglabでは、コンポーネントの「プロパティ」という形でゲーム内での状態を表現します。  
プロパティは"_"から始まるキーで定義されます。  


### 基本プロパティ

全てのコンポーネントが基本プロパティ"_placed"を持ちます。
これはプロパティが各フィールドに存在する確率を表します。  

なぜ、存在確率なのか？  
それは多くのアナログゲームでは、一部あるいは全てのプレイヤーが知ることができない情報(これを「非公開情報」と言います)が存在するからです。  

例として3枚のカード(カード1, カード2, カード3)が裏向きで積まれた山札を考えてみます。  
プレイヤーはカード1の場所(山札の上から何番目にあるか？)を特定することはできませんが、それが山札のどこかにあることは知っています。
そして、それが場に出ていないことも知っています。
この状態をaglabでは下記の通り表現します。  
```
【カード1】 山札(上から順に):[0.33, 0.33, 0.33], 場:[0]
【カード2】 山札(上から順に):[0.33, 0.33, 0.33], 場:[0]
【カード3】 山札(上から順に):[0.33, 0.33, 0.33], 場:[0]
```

山札の1番上のカードをオープンし、場に出します。それがカード1だった場合は以下のようになります。  
```
【カード1】 山札(上から順に):[0   , 0   , 0   ], 場:[1]
【カード2】 山札(上から順に):[0   , 0.5 , 0.5 ], 場:[0]
【カード3】 山札(上から順に):[0   , 0.5 , 0.5 ], 場:[0]
```

さらに1枚オープンします。それがカード3だった場合、山札に残っているのはカード2で確定します。  
```
【カード1】 山札(上から順に):[0   , 0   , 0   ], 場:[1   , 0   ]
【カード2】 山札(上から順に):[0   , 0   , 1   ], 場:[0   , 0   ]
【カード3】 山札(上から順に):[0   , 0   , 0   ], 場:[0   , 1   ]
```

このように、存在確率を使うことで「公開情報」「非公開情報」「非公開情報だが自明なもの」を同様に表現することができます。  


### フィールド(fields)

先の例で言うと、「山札」「場」がフィールドにあたります。  
このようにテーブル上の特定のエリアだと分かりやすいかと思いますが、aglabではコンポーネントを配置可能な箇所すべてをフィールドとして定義します。
よって、「各プレイヤーの手札」や「将棋盤のマス目」等もフィールドとなります。  

たいていのフィールドにはコンポーネントを複数置くことができるかと思います。これを`size`で定義することができます。  

`scope`は情報の公開範囲を定義します。`scope`には以下の3つの値を指定することができます。  
* 'public':公開情報  
このフィールドに配置されたコンポーネントの情報(プロパティの値。以下同様)はすべてのプレイヤーが知ることができます。
* 'hidden':非公開情報  
このフィールドに配置されたコンポーネントの情報は基本的に知ることはできません。特殊アクション等により知る可能性はあります。
* 'private':秘匿情報  
このフィールドに配置されたコンポーネントの情報は基本的にその所有プレイヤーのみ知ることができます。

`shorten`はそのフィールドの省略表現です。  
コンポーネントの移動元/先を指定するとき等に利用することができます。  

`distinguishable`はそのフィールド内での位置が意味を持つ際にTrueとなる設定項目です。  
例えば自分の手札が5枚あるとき、「一番左にあるカード」が真ん中にあっても右端にあってもゲーム的に意味が変わらない場合は`'distinguishable':False`です。  
一方、手札から捨てたカードは「1番目に捨てたカード」と「2番目に捨てたカード」とで意味が変わる場合があります。
例えば、「最後に捨てたカードしか回収できない」「1番目に捨てたカードから戦略を推測できる」等です。
その場合、`'distinguishable':True`となります。  

#### フィールドの定義例

山札(デッキ)
```
    'deck':{
        'name': 'デッキ',
        'size': 60,
        'shorten': 'd',
        'distinguishable': False,
        'scope':'hidden'},
```

手札
```
    'player-1_hand':{
        'name': 'プレイヤー1の手札',
        'size': 7,
        'shorten': 'P1.h',
        'distinguishable': False,
        'scope':'private'},
    'player-2_hand':{
        'name': 'プレイヤー2の手札',
        'size': 7,
        'shorten': 'P2.h',
        'distinguishable': False,
        'scope':'private'},
    ...
```

将棋盤
```
    'board':{
        'name': '盤',
        'size': 81, # 9×9
        'shorten': 'b',
        'distinguishable': True,
        'scope':'public'},
```

### コンポーネントの設定項目

`num`はそのコンポーネントの数量です。  

`str`にはプレイ時に画面表示される文字を設定します。  
表示が不揃いになるのを避けるため、すべてのコンポーネントで文字数を同じにすることを推奨します。  

'_'で始まる項目はプロパティです。  
`_placed`はすべてのコンポーネントで必須です。  
`_placed`以外のプロパティは今後定義できるようにしていきます。  


## コンテキスト(contexts)

コンポーネントのプロパティとして表現できない情報は「コンテキスト」として定義します。  
ポイントは「数字で表現する」です。  

### 数字への変換

とは言っても、一見数字で表現するのに向かない情報もあります。  
その場合はどうすべきでしょう？  

ゲームの状態を表現する上で必要ない情報(例：プレイヤーの名前)であれば、そもそも定義する必要がありません。  

必要な情報であればどうにかして数字に変換する必要があります。  
ここで「[尺度](https://ja.wikipedia.org/wiki/%E5%B0%BA%E5%BA%A6%E6%B0%B4%E6%BA%96)」という概念を紹介します。
尺度のうち「順序尺度」「間隔尺度」「比率/比例尺度」については元から数字で表されているものなので問題ないかと思います。  
残った「名義尺度」がこの項の主役です。  

例えば「負け抜け」形式のゲームの場合、"$player-1_lose"といったコンテキストを定義します。
この項目は"0"の初期値でプレイを開始し、プレイヤー1が負けたら"1"にします。死亡フラグと言ったら分かりやすいでしょうか？
これが「名義尺度」です。  

プレイヤー番号も名義尺度です。3人プレイの場合、便宜的に手番順で"1", "2", "3"とプレイヤー番号を振ります。  
ゲームによってはラウンドごとに手番が変わることがあります。その場合でもプレイヤー番号は変わりません。
あくまでプレイヤーを識別するために数字を割り当てているにすぎないということです。  

### コンテキストの設定項目

コンテキストに`size`を定義すると、配列のように使うことができます。
ただし、サイズをプレイ中に動的に変更することはできませんので、十分に大きいサイズを設定するようにしてください。  

`scope`には[フィールド](designersguide.md#フィールドfields)のそれと同じ値を設定することができ、意味も同じです。  

`value`はプレイ開始時の初期値を設定します。


### キューとスタック

コンテキストにも`size`を指定できますが、
「[キュー](https://ja.wikipedia.org/wiki/%E3%82%AD%E3%83%A5%E3%83%BC_%28%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%29)」
「[スタック](https://ja.wikipedia.org/wiki/%E3%82%B9%E3%82%BF%E3%83%83%E3%82%AF)」
といった概念を理解しておくと、より高度な情報が管理できるようになります。  

例えば、手番順はキューとして扱うのが自然です。  
第1ラウンド開始時、`[^1, 2, 3, , , ](^は手番の位置を示すポインタ)`という手番順だったとします。
この時点で第2ラウンドの手番順は決定していません。  
プレイヤー1が手番を実行した後、もしゲームから脱落していなければキューの最後に追加されます。`[ 1,^2, 3, 1, , ]`  
手番順と合わせて、手番の位置を示すコンテキストを定義すると良いでしょう。
これはターン番号と同義ですが、`size:6`と定義したコンテキストのインデックスは0〜5である(=ターン番号-1)である点に注意が必要です。  

「デッキ(山札)にカードを戻す」「デッキからカードを引く」といった動作はスタックそのものです。  

実際の定義は下の定義例で確認してください。  


### 少し高度なコンテキストの定義例

手番順・ターン番号
```
    '$turn-order':{
        'desc': '手番順を示すプレイヤー番号',
        'size': 36, #理論上の最大ターン数を設定する
        'scope':'public'},
    '$turn-no':{
        'desc': 'ターン番号',
        'scope':'public',
        'value':0},
```

デッキ枚数(@see common.set_deck)
```
    '$deck-count':{
        'desc': 'デッキに積まれているカードの枚数',
        'scope':'public',
        'value':0},
```
[解説]
 デッキ枚数をコンテキストとして定義すると、スタックポインタとしても利用できるのでオススメです。  
 デッキにカードを積む(push)際はポインタが指している位置にカードをセットし、ポインタを+1します。
デッキからカードを取得(pop)する際はポインタが指している位置-1のカードを取得し、ポインタを-1します。


## モジュール

ゲームのメカニクスとして一般的なものはモジュールとして提供し、ゲーム定義の負担を減らしたいと考えています。  
モジュールはmoduleディレクトリーにあり、ゲーム定義ファイルにimportして利用します。  

現時点ではcommonモジュールしかありませんが、Board Game Geekにおける[カテゴリ](https://boardgamegeek.com/browse/boardgamemechanic)をベースに作っていく予定です。  

